#include <Keypad.h> // Thư viện để giao tiếp với bàn phím

// Cấu hình bàn phím ma trận 4x4
const byte ROWS = 4;             // Số hàng
const byte COLS = 4;             // Số cột
char keys[ROWS][COLS] = {        // Các phím trên bàn phím
  {'1', '2', '3', 'A'},
  {'4', '5', '6', 'B'},
  {'7', '8', '9', 'C'},
  {'*', '0', '#', 'D'}
};

// Chân nối bàn phím với ESP32
byte rowPins[ROWS] = {13, 12, 14, 27}; // Chân nối hàng
byte colPins[COLS] = {26, 25, 33, 32}; // Chân nối cột

// Khởi tạo bàn phím
Keypad keypad = Keypad(makeKeymap(keys), rowPins, colPins, ROWS, COLS);

// Mật khẩu cần kiểm tra
const String password = "1234";
String inputPassword = ""; // Lưu trữ mật khẩu nhập từ bàn phím

// Chân LED
const int ledPin = 2;

void setup() {
  pinMode(ledPin, OUTPUT);  // Đặt chế độ chân LED là OUTPUT
  digitalWrite(ledPin, LOW); // Tắt LED ban đầu
  Serial.begin(115200);     // Kết nối Serial để debug
  Serial.println("Nhap mat khau:");
}

void loop() {
  char key = keypad.getKey(); // Đọc phím từ bàn phím

  if (key) { // Nếu có phím được nhấn
    Serial.print("Ban nhan: ");
    Serial.println(key);

    if (key == '#') { // '#' dùng để kiểm tra mật khẩu
      if (inputPassword == password) {
        Serial.println("Mat khau dung! LED sang.");
        digitalWrite(ledPin, HIGH); // Bật LED
      } else {
        Serial.println("Sai mat khau! LED tat.");
        digitalWrite(ledPin, LOW);  // Tắt LED
      }
      inputPassword = ""; // Xóa nội dung đã nhập
    } else if (key == '*') { // '*' dùng để xóa mật khẩu đã nhập
      Serial.println("Xoa mat khau nhap vao.");
      inputPassword = "";
    } else {
      inputPassword += key; // Thêm ký tự vào mật khẩu nhập
      Serial.print("Mat khau hien tai: ");
      Serial.println(inputPassword);
    }
  }
}
